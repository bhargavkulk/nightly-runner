<!doctype html>
<title>Nightly runs</title>

% from datetime import datetime, timedelta

<style>
th { text-align: left; }
form.inline { display: inline; }
</style>

<h1>Actions</h1>

%if current:
<p>
  Nightly running with PID {{current["pid"]}}
  for {{datetime.now() - datetime.fromisoformat(current["start"])}}.
</p>
%end

<form action="/logs/" method="get" class="inline">
  <input type=hidden name=C value=M>
  <input type=hidden name=O value=D>
  <button>View logs</button>
</form>

<form action="/dryrun" method="post" class="inline">
  <button>Start a dry run</button>
</form>

<h1 id="repositories">Repositories</h1>
%for repo in runner.repos:

<h2><kbd>{{repo.name}}</kbd></h2>

<ul class="branches">
  %for branch in repo.branches.values():
    <li>
      <form action="/runnow" action="post" class="inline">
        <input type="hidden" name="repo" value="{{repo.name}}" />
        <input type="hidden" name="branch" value="{{branch.name}}" />
        <button>Run now</button>
      </form>
      <form action="/runnext" action="post" class="inline">
        <input type="hidden" name="repo" value="{{repo.name}}" />
        <input type="hidden" name="branch" value="{{branch.name}}" />
        <button>Run tonight</button>
      </form>
      <kbd>{{branch.name}}</kbd>
    </li>
  %end 
</ul>
%end
